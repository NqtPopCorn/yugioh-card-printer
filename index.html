<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Yu-Gi-Oh PDF Export</title>
        <style>
            body {
                font-family: sans-serif;
                text-align: center;
            }
            #card-container {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
                justify-content: center;
                margin-top: 20px;
            }
            .card {
                width: 156px; /* ~59mm */
                height: 228px; /* ~86mm */
                background-size: cover;
                background-position: center;
                border: 1px solid #ccc;
            }
            input[type="text"] {
                width: 400px;
                padding: 5px;
                margin-bottom: 10px;
            }
        </style>
    </head>
    <body>
        <h2>Yu-Gi-Oh PDF Export</h2>

        <input type="text" id="img-url" placeholder="Dán URL ảnh ở đây..." />
        <button onclick="addCard()">Generate</button>
        <button onclick="exportPDF()">Xuất PDF</button>

        <div id="card-container"></div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

        <script>
            const { jsPDF } = window.jspdf;
            const urlList = []; // danh sách URL đã nhập
            const container = document.getElementById("card-container");

            function addCard() {
                const input = document.getElementById("img-url");
                const url = input.value.trim();
                if (url) {
                    urlList.push(url); // lưu vào danh sách
                    //input.value = ""; // khong clear input
                    renderCards(); // render lại toàn bộ
                }
            }

            function renderCards() {
                container.innerHTML = ""; // xóa cũ
                urlList.forEach((url) => {
                    const div = document.createElement("div");
                    div.className = "card";
                    div.style.backgroundImage = `url(${url})`;
                    container.appendChild(div);
                });
            }

            async function exportPDF() {
                const pdf = new jsPDF({
                    orientation: "portrait",
                    unit: "mm",
                    format: "a4",
                });
                const cardW = 59,
                    cardH = 86;
                let x = 10,
                    y = 10;

                for (let i = 0; i < urlList.length; i++) {
                    const img = await loadImage(urlList[i]);
                    pdf.addImage(img, "JPEG", x, y, cardW, cardH);

                    x += cardW; // + gap width neu can
                    if (x + cardW > 210) {
                        x = 10;
                        y += cardH; // + gap height neu can
                    }
                    if (y + cardH > 297) {
                        pdf.addPage();
                        x = 10;
                        y = 10;
                    }
                }

                pdf.save("yugioh-cards.pdf");
            }

            function loadImage(url) {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.crossOrigin = "anonymous";
                    img.onload = () => {
                        const canvas = document.createElement("canvas");
                        canvas.width = img.naturalWidth;
                        canvas.height = img.naturalHeight;
                        const ctx = canvas.getContext("2d");
                        ctx.drawImage(img, 0, 0);
                        resolve(canvas.toDataURL("image/jpeg", 1.0)); // chất lượng cao
                    };
                    img.onerror = reject;
                    img.src = url;
                });
            }
        </script>
    </body>
</html>
